---
title: Migrating within Supabase
subtitle: Learn how to migrate from one Supabase project to another
---

<Admonition type="caution">

For Paid Plan projects, use the simpler and more reliable [Restore to a new project feature](/dashboard/project/_/database/backups/restore-to-new-project)

</Admonition>

<Admonition type="tip">

If you need to move your project to a different organization, see [project transfers](/docs/guides/platform/project-transfer).

</Admonition>

---

## Important to know

What will be restored to the new project?

- Database schema (tables, views, procedures)
- All data and indexes
- Database roles, permissions and users
- Auth user data (user accounts, hashed passwords, and authentication records from the auth schema)

What needs manual reconfiguration?

- Storage objects & settings
- Edge Functions
- Auth settings & API keys
- Realtime settings
- Database extensions and settings
- Read replicas

---

### Backup database

    1. Install the [Supabase CLI](/docs/guides/local-development/cli/getting-started).

    2. Install [Docker Desktop](https://www.docker.com) for your platform.

    3. Get the Database connection string

        <ProjectConfigVariables variable="sessionpooler" />

        If you do not have your database password, reset the password in the [Database Settings](/dashboard/project/_/settings/database).

    4. Run these commands after replacing ```[CONNECTION_STRING]``` with your connection string

        ```bash
        supabase db dump --db-url [CONNECTION_STRING] -f roles.sql --role-only
        supabase db dump --db-url [CONNECTION_STRING] -f schema.sql
        supabase db dump --db-url [CONNECTION_STRING] -f data.sql --use-copy --data-only
        ```

### Restore database backup

1.  Install [PostgreSQL](https://www.postgresql.org/download/) which includes the command line tool psql

2.  Create a [new project](https://database.new). In the new project:

    - Enable [Database Webhooks](/dashboard/project/_/database/hooks) as needed.
    - Enable the [Extensions](/dashboard/project/_/database/extensions) used in the old project.

3.  Get the Database connection string

        <ProjectConfigVariables variable="sessionpooler" />

        If you do not have your database password, reset the password in the [Database Settings](/dashboard/project/_/settings/database).

4.  Run the following command:

          ```bash
          psql \
            --single-transaction \
            --variable ON_ERROR_STOP=1 \
            --file roles.sql \
            --file schema.sql \
            --file data.sql \
            --dbname [CONNECTION_STRING]
          ```

    Depending on your local configuration, the following parameters may be needed to avoid connection errors:

    - sslmode=require
    - gssencmode=disable

Example connection string with these parameters:

    ```bash
    postgresql://postgres.[REF]:[YOUR-PASSWORD]@[REGION].pooler.supabase.com:5432/postgres?sslmode=require&gssencmode=disable
    ```

## Migrate Storage objects

The new project has the old project's Storage buckets, but the Storage objects need to be migrated manually. Use this script to move storage objects from one project to another.

```script
// npm install @supabase/supabase-js@2
const { createClient } = require('@supabase/supabase-js')

const OLD_PROJECT_URL = 'https://xxx.supabase.co'
const OLD_PROJECT_SECRET_KEY = 'old-project-secret-key-xxx'

const NEW_PROJECT_URL = 'https://yyy.supabase.co'
const NEW_PROJECT_SECRET_KEY = 'new-project-secret-key-yyy'

;(async () => {
  const oldSupabaseRestClient = createClient(OLD_PROJECT_URL, OLD_PROJECT_SECRET_KEY, {
    db: {
      schema: 'storage',
    },
  })
  const oldSupabaseClient = createClient(OLD_PROJECT_URL, OLD_PROJECT_SECRET_KEY)
  const newSupabaseClient = createClient(NEW_PROJECT_URL, NEW_PROJECT_SECRET_KEY)

  // make sure you update max_rows in postgrest settings if you have a lot of objects
  // or paginate here
  const { data: oldObjects, error } = await oldSupabaseRestClient.from('objects').select()
  if (error) {
    console.log('error getting objects from old bucket')
    throw error
  }

  for (const objectData of oldObjects) {
    console.log(`moving ${objectData.id}`)
    try {
      const { data, error: downloadObjectError } = await oldSupabaseClient.storage
        .from(objectData.bucket_id)
        .download(objectData.name)
      if (downloadObjectError) {
        throw downloadObjectError
      }

      const { _, error: uploadObjectError } = await newSupabaseClient.storage
        .from(objectData.bucket_id)
        .upload(objectData.name, data, {
          upsert: true,
          contentType: objectData.metadata.mimetype,
          cacheControl: objectData.metadata.cacheControl,
        })
      if (uploadObjectError) {
        throw uploadObjectError
      }
    } catch (err) {
      console.log('error moving ', objectData)
      console.log(err)
    }
  }
})()
```
